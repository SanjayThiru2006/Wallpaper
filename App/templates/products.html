{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pink Luxury Supermarket</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { 
      margin: 0; 
      font-family: 'Poppins', sans-serif; 
      background: #ffe6f0; 
    }

    header { 
      background: linear-gradient(90deg, #ff99cc, #ff66b2); 
      color: white; 
      text-align: center; 
      padding: 15px; 
      font-size: 24px; 
      font-weight: 600; 
    }

    .top-right { 
      display: flex; 
      justify-content: flex-end; 
      padding: 10px 20px; 
    }

    .top-right a { 
      color: #ff3399; 
      font-weight: 600; 
      text-decoration: none; 
      border: 2px solid #ff66b2; 
      padding: 5px 12px; 
      border-radius: 20px; 
      background: white;
    }

    .top-right a:hover { 
      background: #ff66b2; 
      color: white; 
    }

    /* CATEGORY BAR WITH SCROLL BUTTONS */
    .category-container {
      display: flex; 
      align-items: center;
      padding: 10px;
      background: #ffd6e9; 
      border-bottom: 2px solid #ffb6d9;
    }

    .scroll-btn {
      background: #ff66b2; 
      color: white; 
      border: none; 
      border-radius: 50%; 
      width: 35px; 
      height: 35px; 
      font-size: 18px; 
      cursor: pointer; 
      margin: 0 5px;
    }

    .scroll-btn:hover { background: #ff3385; }

    .category-bar { 
      display: flex; 
      overflow-x: hidden; 
      gap: 10px; 
      flex: 1; 
      scroll-behavior: smooth; 
    }

    .category-bar a { 
      background: white; 
      border: 2px solid #ff66b2; 
      border-radius: 20px; 
      padding: 8px 20px; 
      color: #ff3399; 
      text-decoration: none; 
      font-weight: 500; 
      white-space: nowrap; 
      flex-shrink: 0; 
    }

    .category-bar a:hover { background: #ff66b2; color: white; }

    .products { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
      gap: 15px; 
      padding: 20px; 
    }

    .product { 
      background: white; 
      border-radius: 15px; 
      box-shadow: 0 4px 10px rgba(255,102,178,0.3); 
      text-align: center; 
      padding: 10px; 
    }

    .product img { 
      width: 100%; 
      height: 160px; 
      object-fit: cover; 
      border-radius: 10px; 
    }

    .product h4 { 
      color: #ff3399; 
      margin: 10px 0 5px; 
    }

    .product p { 
      color: #555; 
      margin-bottom: 10px; 
    }

    .product a, .cart-action button { 
      background: #ff66b2; 
      color: white; 
      padding: 6px 12px; 
      border-radius: 8px; 
      text-decoration: none; 
      margin: 0 5px; 
      cursor: pointer;
      border: none;
      font-weight: 500;
    }

    .product a:hover, .cart-action button:hover { 
      background: #ff3385; 
    }

    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .quantity-selector input {
      width: 40px;
      text-align: center;
      border-radius: 8px;
      border: 1px solid #ff66b2;
      padding: 4px;
      font-weight: 600;
    }

    .out-of-stock {
      background: #ccc !important;
      color: #666 !important;
      cursor: not-allowed !important;
    }
  </style>
</head>
<body>

  <header>ðŸŒ¸ Pink Luxury Supermarket ðŸŒ¸</header>

  <div class="top-right">
      <a href="{% url 'logout' %}">ðŸšª Logout</a>
  </div>

  <!-- Category bar with scroll buttons -->
  <div class="category-container">
      <button class="scroll-btn" id="scroll-left">â—€</button>
      <div class="category-bar" id="category-bar">
        {% for c in category %}
          <a href="">{{ c.name }}</a>
        {% endfor %}
      </div>
      <button class="scroll-btn" id="scroll-right">â–¶</button>
  </div>

  <div class="products" id="product">
    {% for p in product %}
      <div class="product" data-product-id="{{ p.id }}" data-max="{{ p.quantity }}">
        <img src="{{ p.image.url }}" alt="{{ p.name }}">
        <h4>{{ p.name }}</h4>
        <p>${{ p.price }}</p>
        
        <!-- Add to Cart / Quantity Selector -->
        <div class="cart-action">
          {% if p.quantity > 0 %}
            <button class="add-cart-btn">Add to Cart</button>
          {% else %}
            <button class="add-cart-btn out-of-stock" disabled>Out of Stock</button>
          {% endif %}
          <div class="quantity-selector" style="display:none;">
            <button class="decrease">-</button>
            <input type="text" value="1" readonly>
            <button class="increase">+</button>
          </div>
        </div>
      </div>
    {% empty %}
      <p style="text-align:center;">No products available in this category.</p>
    {% endfor %}
  </div>

  <script>
    // Scroll category bar
    const bar = document.getElementById('category-bar');
    document.getElementById('scroll-left').addEventListener('click', () => {
      bar.scrollBy({ left: -150, behavior: 'smooth' });
    });
    document.getElementById('scroll-right').addEventListener('click', () => {
      bar.scrollBy({ left: 150, behavior: 'smooth' });
    });

    // Add to Cart quantity logic
    document.querySelectorAll('.product').forEach(product => {
      const addBtn = product.querySelector('.add-cart-btn');
      const qtyDiv = product.querySelector('.quantity-selector');
      const input = qtyDiv.querySelector('input');
      const plusBtn = qtyDiv.querySelector('.increase');
      const minusBtn = qtyDiv.querySelector('.decrease');

      // Skip out-of-stock products
      if (!addBtn || addBtn.disabled) return;

      const MAX_QTY = parseInt(product.dataset.max) || 1;

      // Show quantity selector on click
      addBtn.addEventListener('click', () => {
        addBtn.style.display = 'none';
        qtyDiv.style.display = 'flex';
      });

      // Increase quantity
      plusBtn.addEventListener('click', () => {
        let val = parseInt(input.value);
        if (val < MAX_QTY) input.value = val + 1;
      });

  minusBtn.addEventListener('click', () => {
    let val = parseInt(input.value);
    if (val > 1) {
      input.value = val - 1;
    } else {
      // If quantity is 1, hide quantity selector and show Add to Cart
      qtyDiv.style.display = 'none';
      addBtn.style.display = 'inline-block';
    }
});

    });
  </script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
function updateProducts() {
    $("#product").load("{% url 'live_products' %}");
}

setInterval(updateProducts, 1000);
updateProducts();
</script>

</body>
</html>
